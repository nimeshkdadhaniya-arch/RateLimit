<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1247px" preserveAspectRatio="none" style="width:2199px;height:1247px;background:#FFFFFF;" version="1.1" viewBox="0 0 2199 1247" width="2199px" zoomAndPan="magnify"><defs/><g><g><title>RateLimitFilter</title><rect fill="#FFFFFF" height="1010.4063" style="stroke:#181818;stroke-width:1;" width="10" x="537.9224" y="145.3125"/></g><g><title>IRateLimitService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="782.125" y="175.6641"/></g><g><title>IRateLimitService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="782.125" y="770.0156"/></g><g><title>FilterChain</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="896.7593" y="261.7188"/></g><g><title>FilterChain</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="896.7593" y="886.4219"/></g><g><title>BoundedRetryQueueService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="1120.7871" y="458.6641"/></g><g><title>BoundedRetryQueueService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="1120.7871" y="653.6094"/></g><g><title>AsyncContext</title><rect fill="#FFFFFF" height="720.4063" style="stroke:#181818;stroke-width:1;" width="10" x="1306.5659" y="428.3125"/></g><g><title>AsyncContext</title><rect fill="#FFFFFF" height="91.0547" style="stroke:#181818;stroke-width:1;" width="10" x="1311.5659" y="856.0703"/></g><rect fill="none" height="927.7031" style="stroke:#000000;stroke-width:1.5;" width="2074.9224" x="117.8809" y="221.0156"/><rect fill="none" height="94.8906" style="stroke:#000000;stroke-width:1.5;" width="491.1724" x="127.8809" y="504.0156"/><rect fill="none" height="528.8125" style="stroke:#000000;stroke-width:1.5;" width="1477.5298" x="705.2734" y="612.9063"/><rect fill="none" height="435.7578" style="stroke:#000000;stroke-width:1.5;" width="1457.5298" x="715.2734" y="698.9609"/><rect fill="none" height="267" style="stroke:#000000;stroke-width:1.5;" width="1313.8267" x="848.9766" y="815.3672"/><rect fill="none" height="97.4063" style="stroke:#000000;stroke-width:1.5;" width="1133.126" x="1019.6772" y="977.9609"/><g><title>User</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="18.7793" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="22" x2="22" y1="82.6094" y2="1165.7188"/></g><g><title>HTTP Server</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="208.5737" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="211.8809" x2="211.8809" y1="82.6094" y2="1165.7188"/></g><g><title>RateLimitFilter</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="538.9224" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="542.7915" x2="542.7915" y1="82.6094" y2="1165.7188"/></g><g><title>IRateLimitService</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="783.125" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="786.2734" x2="786.2734" y1="82.6094" y2="1165.7188"/></g><g><title>FilterChain</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="897.7593" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="900.9766" x2="900.9766" y1="82.6094" y2="1165.7188"/></g><g><title>BoundedRetryQueueService</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="1121.7871" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1125.6772" x2="1125.6772" y1="82.6094" y2="1165.7188"/></g><g><title>AsyncContext</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="1307.5659" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1311.3799" x2="1311.3799" y1="82.6094" y2="1165.7188"/></g><g><title>RetryWorker</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="1600.3301" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1604.2925" x2="1604.2925" y1="82.6094" y2="1165.7188"/></g><g><title>DroppedRequest</title><rect fill="#000000" fill-opacity="0.00000" height="1083.1094" width="8" x="1976.9487" y="82.6094"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1980.0942" x2="1980.0942" y1="82.6094" y2="1165.7188"/></g><g class="participant participant-head" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29.5586" x="5" y="79.5332">User</text><ellipse cx="22.7793" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M22.7793,21.5 L22.7793,48.5 M9.7793,29.5 L35.7793,29.5 M22.7793,48.5 L9.7793,63.5 M22.7793,48.5 L35.7793,63.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="User"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29.5586" x="5" y="1179.252">User</text><ellipse cx="22.7793" cy="1190.8281" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M22.7793,1198.8281 L22.7793,1225.8281 M9.7793,1206.8281 L35.7793,1206.8281 M22.7793,1225.8281 L9.7793,1240.8281 M22.7793,1225.8281 L35.7793,1240.8281" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Server"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149.3857" x="137.8809" y="32.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.6758" x="171.7358" y="53.9238">HTTP Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.3857" x="144.8809" y="71.5332">(Tomcat / Embedded)</text></g><g class="participant participant-tail" data-participant="Server"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149.3857" x="137.8809" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.6758" x="171.7358" y="1186.252">HTTP Server</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.3857" x="144.8809" y="1203.8613">(Tomcat / Embedded)</text></g><g class="participant participant-head" data-participant="Filter"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132.2617" x="476.7915" y="32.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.2412" x="497.8018" y="53.9238">RateLimitFilter</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2617" x="483.7915" y="71.5332">.doFilterInternal(...)</text></g><g class="participant participant-tail" data-participant="Filter"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="132.2617" x="476.7915" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90.2412" x="497.8018" y="1186.252">RateLimitFilter</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118.2617" x="483.7915" y="1203.8613">.doFilterInternal(...)</text></g><g class="participant participant-head" data-participant="RateLimitService"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.7031" x="725.2734" y="32.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.7031" x="732.2734" y="53.9238">IRateLimitService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.9033" x="743.1733" y="71.5332">.tryAcquire(...)</text></g><g class="participant participant-tail" data-participant="RateLimitService"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="123.7031" x="725.2734" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109.7031" x="732.2734" y="1186.252">IRateLimitService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87.9033" x="743.1733" y="1203.8613">.tryAcquire(...)</text></g><g class="participant participant-head" data-participant="Chain"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85.5654" x="858.9766" y="32.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.6895" x="867.9146" y="53.9238">FilterChain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71.5654" x="865.9766" y="71.5332">.doFilter(...)</text></g><g class="participant participant-tail" data-participant="Chain"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="85.5654" x="858.9766" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67.6895" x="867.9146" y="1186.252">FilterChain</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71.5654" x="865.9766" y="1203.8613">.doFilter(...)</text></g><g class="participant participant-head" data-participant="RetryQueue"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="192.2197" x="1029.6772" y="32.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="178.2197" x="1036.6772" y="53.9238">BoundedRetryQueueService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.4336" x="1058.0703" y="71.5332">.enqueue()/dequeue()</text></g><g class="participant participant-tail" data-participant="RetryQueue"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="192.2197" x="1029.6772" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="178.2197" x="1036.6772" y="1186.252">BoundedRetryQueueService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.4336" x="1058.0703" y="1203.8613">.enqueue()/dequeue()</text></g><g class="participant participant-head" data-participant="Async"><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100.3721" x="1261.3799" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86.3721" x="1268.3799" y="71.5332">AsyncContext</text></g><g class="participant participant-tail" data-participant="Async"><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100.3721" x="1261.3799" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86.3721" x="1268.3799" y="1186.252">AsyncContext</text></g><g class="participant participant-head" data-participant="Worker"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140.0752" x="1534.2925" y="32.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.5586" x="1565.0508" y="53.9238">RetryWorker</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.0752" x="1541.2925" y="71.5332">(background thread)</text></g><g class="participant participant-tail" data-participant="Worker"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140.0752" x="1534.2925" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.5586" x="1565.0508" y="1186.252">RetryWorker</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.0752" x="1541.2925" y="1203.8613">(background thread)</text></g><g class="participant participant-head" data-participant="DroppedRequest"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="323.709" x="1819.0942" y="32.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.8477" x="1928.0249" y="53.9238">DroppedRequest</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="309.709" x="1826.0942" y="71.5332">(request,response,chain,asyncContext,retriesLeft)</text></g><g class="participant participant-tail" data-participant="DroppedRequest"><rect fill="#E2E2F0" height="49.2188" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="323.709" x="1819.0942" y="1164.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105.8477" x="1928.0249" y="1186.252">DroppedRequest</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="309.709" x="1826.0942" y="1203.8613">(request,response,chain,asyncContext,retriesLeft)</text></g><g><title>RateLimitFilter</title><rect fill="#FFFFFF" height="1010.4063" style="stroke:#181818;stroke-width:1;" width="10" x="537.9224" y="145.3125"/></g><g><title>IRateLimitService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="782.125" y="175.6641"/></g><g><title>IRateLimitService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="782.125" y="770.0156"/></g><g><title>FilterChain</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="896.7593" y="261.7188"/></g><g><title>FilterChain</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="896.7593" y="886.4219"/></g><g><title>BoundedRetryQueueService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="1120.7871" y="458.6641"/></g><g><title>BoundedRetryQueueService</title><rect fill="#FFFFFF" height="30.3516" style="stroke:#181818;stroke-width:1;" width="10" x="1120.7871" y="653.6094"/></g><g><title>AsyncContext</title><rect fill="#FFFFFF" height="720.4063" style="stroke:#181818;stroke-width:1;" width="10" x="1306.5659" y="428.3125"/></g><g><title>AsyncContext</title><rect fill="#FFFFFF" height="91.0547" style="stroke:#181818;stroke-width:1;" width="10" x="1311.5659" y="856.0703"/></g><g class="message" data-participant-1="User" data-participant-2="Server"><polygon fill="#181818" points="200.5737,110.9609,210.5737,114.9609,200.5737,118.9609,204.5737,114.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="22.7793" x2="206.5737" y1="114.9609" y2="114.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165.7944" x="29.7793" y="110.1045">HTTP GET /api/limit?type=...</text></g><g class="message" data-participant-1="Server" data-participant-2="Filter"><polygon fill="#181818" points="525.9224,141.3125,535.9224,145.3125,525.9224,149.3125,529.9224,145.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="212.5737" x2="531.9224" y1="145.3125" y2="145.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260.8506" x="219.5737" y="140.4561">call doFilterInternal(request, response, chain)</text></g><g class="message" data-participant-1="Filter" data-participant-2="RateLimitService"><polygon fill="#181818" points="770.125,171.6641,780.125,175.6641,770.125,179.6641,774.125,175.6641" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="547.9224" x2="776.125" y1="175.6641" y2="175.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110.5381" x="554.9224" y="170.8076">tryAcquire(request)</text></g><g class="message" data-participant-1="RateLimitService" data-participant-2="Filter"><polygon fill="#181818" points="558.9224,202.0156,548.9224,206.0156,558.9224,210.0156,554.9224,206.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="552.9224" x2="786.125" y1="206.0156" y2="206.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.7471" x="564.9224" y="201.1592">boolean acquired</text></g><path d="M117.8809,221.0156 L178.0518,221.0156 L178.0518,229.3672 L168.0518,239.3672 L117.8809,239.3672 L117.8809,221.0156" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="927.7031" style="stroke:#000000;stroke-width:1.5;" width="2074.9224" x="117.8809" y="221.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="132.8809" y="235.5107">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="92.9146" x="193.0518" y="234.4346">[acquired == true]</text><g class="message" data-participant-1="Filter" data-participant-2="Chain"><polygon fill="#181818" points="884.7593,257.7188,894.7593,261.7188,884.7593,265.7188,888.7593,261.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="547.9224" x2="890.7593" y1="261.7188" y2="261.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.7598" x="554.9224" y="256.8623">chain.doFilter(request, response)</text></g><g class="message" data-participant-1="Chain" data-participant-2="Filter"><polygon fill="#181818" points="558.9224,288.0703,548.9224,292.0703,558.9224,296.0703,554.9224,292.0703" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="552.9224" x2="900.7593" y1="292.0703" y2="292.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198.3389" x="564.9224" y="287.2139">processed (controller -&gt; response)</text></g><g class="message" data-participant-1="Filter" data-participant-2="Server"><polygon fill="#181818" points="223.5737,318.4219,213.5737,322.4219,223.5737,326.4219,219.5737,322.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="217.5737" x2="536.9224" y1="322.4219" y2="322.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143.7681" x="229.5737" y="317.5654">return 200 OK (Limit OK)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="117.8809" x2="2192.8032" y1="331.4219" y2="331.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="97.2061" x="122.8809" y="342.8408">[acquired == false]</text><g class="message" data-participant-1="Filter" data-participant-2="Filter"><line style="stroke:#181818;stroke-width:1;" x1="547.9224" x2="589.9224" y1="384.9609" y2="384.9609"/><line style="stroke:#181818;stroke-width:1;" x1="589.9224" x2="589.9224" y1="384.9609" y2="397.9609"/><line style="stroke:#181818;stroke-width:1;" x1="548.9224" x2="589.9224" y1="397.9609" y2="397.9609"/><polygon fill="#181818" points="558.9224,393.9609,548.9224,397.9609,558.9224,401.9609,554.9224,397.9609" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116.3145" x="554.9224" y="363.7529">request.startAsync()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.2026" x="554.9224" y="380.1045">setTimeout(ASYNC_TIMEOUT_MS)</text></g><g class="message" data-participant-1="Filter" data-participant-2="Async"><polygon fill="#181818" points="1294.5659,424.3125,1304.5659,428.3125,1294.5659,432.3125,1298.5659,428.3125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="547.9224" x2="1300.5659" y1="428.3125" y2="428.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119.2344" x="554.9224" y="423.4561">obtain AsyncContext</text></g><g class="message" data-participant-1="Filter" data-participant-2="RetryQueue"><polygon fill="#181818" points="1108.7871,454.6641,1118.7871,458.6641,1108.7871,462.6641,1112.7871,458.6641" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="547.9224" x2="1114.7871" y1="458.6641" y2="458.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="553.8647" x="554.9224" y="453.8076">enqueue(new DroppedRequest(request,response,chain,asyncContext, retries=MAX_RETRIES))</text></g><g class="message" data-participant-1="RetryQueue" data-participant-2="Filter"><polygon fill="#181818" points="558.9224,485.0156,548.9224,489.0156,558.9224,493.0156,554.9224,489.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="552.9224" x2="1124.7871" y1="489.0156" y2="489.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.7197" x="564.9224" y="484.1592">boolean enqueued</text></g><path d="M127.8809,504.0156 L188.0518,504.0156 L188.0518,512.3672 L178.0518,522.3672 L127.8809,522.3672 L127.8809,504.0156" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="94.8906" style="stroke:#000000;stroke-width:1.5;" width="491.1724" x="127.8809" y="504.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="142.8809" y="518.5107">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99.0161" x="203.0518" y="517.4346">[enqueued == true]</text><g class="message" data-participant-1="Filter" data-participant-2="Server"><polygon fill="#181818" points="223.5737,540.7188,213.5737,544.7188,223.5737,548.7188,219.5737,544.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="217.5737" x2="536.9224" y1="544.7188" y2="544.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301.3486" x="229.5737" y="539.8623">202 Accepted (accepted for background processing)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="127.8809" x2="619.0532" y1="553.7188" y2="553.7188"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="103.3076" x="132.8809" y="565.1377">[enqueued == false]</text><g class="message" data-participant-1="Filter" data-participant-2="Server"><polygon fill="#181818" points="223.5737,586.9063,213.5737,590.9063,223.5737,594.9063,219.5737,590.9063" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="217.5737" x2="536.9224" y1="590.9063" y2="590.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="261.2188" x="229.5737" y="586.0498">429 Too Many Requests (queue full -&gt; reject)</text></g><path d="M705.2734,612.9063 L770.5034,612.9063 L770.5034,621.2578 L760.5034,631.2578 L705.2734,631.2578 L705.2734,612.9063" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="528.8125" style="stroke:#000000;stroke-width:1.5;" width="1477.5298" x="705.2734" y="612.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20.23" x="720.2734" y="627.4014">par</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174.1792" x="785.5034" y="626.3252">[Retry worker loop (background)]</text><g class="message" data-participant-1="Worker" data-participant-2="RetryQueue"><polygon fill="#181818" points="1141.7871,649.6094,1131.7871,653.6094,1141.7871,657.6094,1137.7871,653.6094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1135.7871" x2="1603.3301" y1="653.6094" y2="653.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59.2681" x="1147.7871" y="648.7529">dequeue()</text></g><g class="message" data-participant-1="RetryQueue" data-participant-2="Worker"><polygon fill="#181818" points="1592.3301,679.9609,1602.3301,683.9609,1592.3301,687.9609,1596.3301,683.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1125.7871" x2="1598.3301" y1="683.9609" y2="683.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137.3062" x="1132.7871" y="679.1045">DroppedRequest or null</text></g><path d="M715.2734,698.9609 L775.4443,698.9609 L775.4443,707.3125 L765.4443,717.3125 L715.2734,717.3125 L715.2734,698.9609" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="435.7578" style="stroke:#000000;stroke-width:1.5;" width="1457.5298" x="715.2734" y="698.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="730.2734" y="713.4561">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="95.0254" x="790.4443" y="712.3799">[dequeued != null]</text><g class="message" data-participant-1="Worker" data-participant-2="DroppedRequest"><polygon fill="#181818" points="1968.9487,735.6641,1978.9487,739.6641,1968.9487,743.6641,1972.9487,739.6641" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1604.3301" x2="1974.9487" y1="739.6641" y2="739.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.6499" x="1611.3301" y="734.8076">inspect(retriesLeft)</text></g><g class="message" data-participant-1="Worker" data-participant-2="RateLimitService"><polygon fill="#181818" points="803.125,766.0156,793.125,770.0156,803.125,774.0156,799.125,770.0156" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="797.125" x2="1603.3301" y1="770.0156" y2="770.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161.8589" x="809.125" y="765.1592">tryAcquire(dropped.request)</text></g><g class="message" data-participant-1="RateLimitService" data-participant-2="Worker"><polygon fill="#181818" points="1592.3301,796.3672,1602.3301,800.3672,1592.3301,804.3672,1596.3301,800.3672" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="787.125" x2="1598.3301" y1="800.3672" y2="800.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.7471" x="794.125" y="795.5107">boolean acquired</text></g><path d="M848.9766,815.3672 L909.1475,815.3672 L909.1475,823.7188 L899.1475,833.7188 L848.9766,833.7188 L848.9766,815.3672" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="267" style="stroke:#000000;stroke-width:1.5;" width="1313.8267" x="848.9766" y="815.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="863.9766" y="829.8623">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="92.9146" x="924.1475" y="828.7861">[acquired == true]</text><g class="message" data-participant-1="Worker" data-participant-2="Async"><polygon fill="#181818" points="1332.5659,852.0703,1322.5659,856.0703,1332.5659,860.0703,1328.5659,856.0703" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1326.5659" x2="1603.3301" y1="856.0703" y2="856.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.7642" x="1338.5659" y="851.2139">dispatch/resume using dropped.asyncContext</text></g><g class="message" data-participant-1="Async" data-participant-2="Chain"><polygon fill="#181818" points="917.7593,882.4219,907.7593,886.4219,917.7593,890.4219,913.7593,886.4219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="911.7593" x2="1310.5659" y1="886.4219" y2="886.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="305.6714" x="923.7593" y="881.5654">resume/doFilter(dropped.request, dropped.response)</text></g><g class="message" data-participant-1="Chain" data-participant-2="Async"><polygon fill="#181818" points="1299.5659,912.7734,1309.5659,916.7734,1299.5659,920.7734,1303.5659,916.7734" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="901.7593" x2="1305.5659" y1="916.7734" y2="916.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132.6025" x="908.7593" y="911.917">processed -&gt; response</text></g><g class="message" data-participant-1="Async" data-participant-2="Worker"><polygon fill="#181818" points="1592.3301,943.125,1602.3301,947.125,1592.3301,951.125,1596.3301,947.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1316.5659" x2="1598.3301" y1="947.125" y2="947.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.4961" x="1323.5659" y="942.2686">complete / cleanup asyncContext</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="848.9766" x2="2162.8032" y1="956.125" y2="956.125"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="97.2061" x="853.9766" y="967.5439">[acquired == false]</text><path d="M1019.6772,977.9609 L1079.8481,977.9609 L1079.8481,986.3125 L1069.8481,996.3125 L1019.6772,996.3125 L1019.6772,977.9609" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="97.4063" style="stroke:#000000;stroke-width:1.5;" width="1133.126" x="1019.6772" y="977.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15.1709" x="1034.6772" y="992.4561">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="126.8276" x="1094.8481" y="991.3799">[dropped.retriesLeft &gt; 0]</text><g class="message" data-participant-1="Worker" data-participant-2="RetryQueue"><polygon fill="#181818" points="1136.7871,1014.6641,1126.7871,1018.6641,1136.7871,1022.6641,1132.7871,1018.6641" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1130.7871" x2="1603.3301" y1="1018.6641" y2="1018.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222.5679" x="1142.7871" y="1013.8076">re-enqueue(dropped with retriesLeft-1)</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="1019.6772" x2="2152.8032" y1="1027.6641" y2="1027.6641"/><g class="message" data-participant-1="Worker" data-participant-2="DroppedRequest"><polygon fill="#181818" points="1968.9487,1063.3672,1978.9487,1067.3672,1968.9487,1071.3672,1972.9487,1067.3672" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1604.3301" x2="1974.9487" y1="1067.3672" y2="1067.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99.0107" x="1611.3301" y="1046.1592">respond with 429</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="352.6187" x="1611.3301" y="1062.5107">(dropped.response.setStatus(429); asyncContext.complete())</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="715.2734" x2="2172.8032" y1="1090.3672" y2="1090.3672"/><g class="message" data-participant-1="Worker" data-participant-2="Worker"><line style="stroke:#181818;stroke-width:1;" x1="1604.3301" x2="1646.3301" y1="1113.7188" y2="1113.7188"/><line style="stroke:#181818;stroke-width:1;" x1="1646.3301" x2="1646.3301" y1="1113.7188" y2="1126.7188"/><line style="stroke:#181818;stroke-width:1;" x1="1605.3301" x2="1646.3301" y1="1126.7188" y2="1126.7188"/><polygon fill="#181818" points="1615.3301,1122.7188,1605.3301,1126.7188,1615.3301,1130.7188,1611.3301,1126.7188" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160.418" x="1611.3301" y="1108.8623">wait/sleep until next attempt</text></g><!--SRC=[ZLRVRzGu47xFNp7mb4ZjRgbuOT5oMifoLq7Xw0RT8I5LhZEbXgmT78VI__x6TdxOINPr-z1c7SyttymtyxMC6wNXSuqwgPWsWekAIGDF_yhpls67-XVghpBDrPup0qlOxc-nAB38dWAhs_Tnu3Kp-5xiXNahIcE35uNoZvUIVaXMfel5miVxypZ-iWUmw88Z8HZzkE4_6w5nY1rVYr4yyiKz4p9WC4IxDt78QzL8gkmQATkd1XiSygFyQG_IR5bW- -Gvz7TZg4tzAFc5edf_6tVH7OpwP6F_KVg7Q_0jup- -QSi0pBr6rZROluy3tsXLLPOdCQaDnMh_TAAnhfIiyOJRuavOG8BU6IsmVeztnYF7A4bY9m1ENxMIhi3f_-SsXoMhnBAqZVx3F5QufXOc_fAzxlkw0ixA4YP2TyoWfmQEMvOmRiGlKh0RWSJ_jf1ZOLSGoDyY1W2JEHWVm6d0yrQf4fa4vl6AfC33I0ahJNyJrciYGae3VGQsRf1MlgnXpYQ5PowiJ-N7pnwvfuXYfHN7kgQCAIVrj2fBdoh62eWFQ1slG4XIlj4Ipi_EuECxI5s1z9GbMDOOLNV7w6HKNaUgBMXH6nf5DyrfzfMuc5piKJKctUo-VBYuoI-ljXy_vpTNksm4v69Me6wDhJTSaBWpVbD6mSEUhQ3RHOaFeo7-Nui0xIQihpR_tbnly-lBxIuRgHEijJqVliwEKake6AiIe7Xu6gRkRZHC1uGxFpk73UTO6JiAh7kw8xiEtAAT5Y6_-IASgc6QGTK3UPwVlu1SARXYyX7QLjQGEWIuQsYltUnzHsxQ5BBm5P4j-IhXmVaKb4fL47XPrkVrHZRMidVJ_juX3MPqy92hqH00jKSIwJxgY2ATAYsD0fwiuzYOUPne1KBM5JKb3RtrGEXHJoiyxgBtjX3Zi3k5jsOzhslGnFF2oAF-5n4vv8Np5RVxNeYwOeRVBsadcpr2OoSLkehPs0PcA_UMC7xjJWC7zWcMlGMFkde2mq5eexCP1qCDFuDLjyKDJXsuyoHirgXdA-a4usfVbKZtby2jSaq5HpiLP9ZsweZDZ-KTEjGFDBo2iydTmmkjyRJpvnOC7eIvXm3nzDcqyJZ7wFZo-NQty6HXz7_GME05_NdQ6MQQEgKBsSkeYOkkoMasmqV6In9-dt0TE7RwFJ1XbdM9M44ZZIX1Ka9Wnk2-6jJhGBlV4nMTpmQdVh3_0m00]--></g></svg>